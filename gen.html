<!DOCTYPE html>
<html lang="ja">
<body style="background:#222;color:#ccc;font-family:sans-serif;">
<canvas id="maze"></canvas>
<script>
function rng(seed) {
  // Xorshift系の固定乱数（シード指定可能）
  let x = seed || Date.now() & 0xffffffff;
  return function() {
    x ^= x << 13; x ^= x >> 17; x ^= x << 5;
    return (x >>> 0) / 0xffffffff;
  };
}

function makeMaze(width, height, seed) {
  const rnd = rng(seed);
  const maze = Array.from({ length: height }, () =>
    Array(width).fill(0)
  );

  // スタート位置を中央に（奇数補正）
  const sx = (Math.floor(width / 2) | 1);
  const sy = (Math.floor(height / 2) | 1);

  const stack = [[sx, sy]];
  const dirs = [[0,-1],[1,0],[0,1],[-1,0]];
  maze[sy][sx] = 1;

  while (stack.length) {
    const [x, y] = stack[stack.length - 1];
    const neighbors = dirs
      .map(([dx, dy]) => [x + dx * 2, y + dy * 2, dx, dy])
      .filter(([nx, ny]) =>
        nx > 0 && ny > 0 && nx < width - 1 && ny < height - 1 &&
        maze[ny][nx] === 0
      );

    if (!neighbors.length) {
      stack.pop();
      continue;
    }

    const [nx, ny, dx, dy] = neighbors[Math.floor(rnd() * neighbors.length)];
    maze[y + dy][x + dx] = 1; // 間の壁を壊す
    maze[ny][nx] = 1;         // 次のセルを開ける
    stack.push([nx, ny]);
  }
  return maze;
}

function drawMaze(maze, scale=8) {
  const canvas = document.getElementById("maze");
  const ctx = canvas.getContext("2d");
  const h = maze.length, w = maze[0].length;
  canvas.width = w * scale;
  canvas.height = h * scale;

  ctx.fillStyle = "#111";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  for (let y = 0; y < h; y++) {
    for (let x = 0; x < w; x++) {
      if (maze[y][x]) {
        ctx.fillStyle = "#eee";
        ctx.fillRect(x * scale, y * scale, scale, scale);
      }
    }
  }
}

const width = 41, height = 41;
// 実行ごとに変わるseed
const seed = Math.floor(Math.random() * 1e9);
console.log("Seed:", seed);

const maze = makeMaze(width, height, seed);
drawMaze(maze, 8);
</script>
</body>
</html>
